<!doctype html>
<meta charset="utf-8" />
<title>Orders Admin</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 20px; }
  .row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
  button { padding:4px 8px; }
  code { background:#f3f3f3; padding:2px 4px; border-radius:4px; }
</style>
<h1>Orders</h1>
<div id="list">Loadingâ€¦</div>
<script>
const base = location.origin;

async function fetchOrders(){
  const r = await fetch(base + '/orders');
  const orders = await r.json();
  const list = document.getElementById('list');
  list.innerHTML = '';
  orders.sort((a,b)=>b.createdAt-a.createdAt).forEach(o=>{
    const div = document.createElement('div');
    div.className = 'row';
    div.innerHTML = `
      <code>${o.orderId}</code>
      <span>Status: <b>${o.status}</b></span>
      <span>Total: ${o.total} kr</span>
      <button data-s="ACCEPTED">ACCEPT</button>
      <button data-s="REJECTED">REJECT</button>
      <button data-s="READY">READY</button>
      <button data-s="COMPLETED">DONE</button>
    `;
    div.querySelectorAll('button').forEach(btn=>{
      btn.onclick = async () => {
        const r = await fetch(base + '/orders/' + o.orderId, {
          method:'PATCH',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ status: btn.dataset.s })
        });
        if(r.ok) fetchOrders();
        else alert('Failed to update');
      };
    });
    list.appendChild(div);
  });
}
fetchOrders();
setInterval(fetchOrders, 5000);
</script>
